/**
 * Copyright (c) 2013 Dmitry Panyushkin.
 * Available under MIT license.
 */
(function(l){function z(c,h,e){if(null==c)return function(b,c){return[b,c]};if(e){if("function"!=typeof c)throw Error("groupJoin supports only functional result selector");if("object"==typeof h)return function(b,e,d,a){return c.call(h,b,e,d,a)}}return"function"!=typeof c?function(){return c}:"object"==typeof h?function(b,e,d,a,f,g){return c.call(h,b,e,d,a,f,g)}:c}l.mixin({hashJoin:function(c,h,e,b,n,d,a,f){var g=[];e=l.createCallback(e,d);b=l.createCallback(b,a);n=z(n,f);var k=function(a,d){var e,
b={};l.forEach(a,function(a,c,h){e=String(d(a,c,h));(Object.prototype.hasOwnProperty.call(b,e)?b[e]:b[e]=[]).push([a,c])});return b}(h,b);l.forEach(c,function(a,b,d){var c=String(e(a,b,d)),c=k[c],f=-1,l=c&&c.length;if("number"===typeof l)for(;++f<l;){var p=c[f],p=n(a,p[0],b,p[1],d,h);null!=p&&g.push(p)}});return g},groupJoin:function(c,h,e,b,n,d,a,f){var g=[];e=l.createCallback(e,d);n=z(n,f,!0);var k=l.groupBy(h,b,a);l.forEach(c,function(a,c,b){var d=String(e(a,c,b));a=n(a,k[d]||[],c,b);null!=a&&
g.push(a)});return g},mergeJoin:function(c,h,e,b,n,d,a,f,g,k){function s(a,c,b){return b?a:l.map(a,function(a,b,d){return[c(a,b,d),a,b]}).sort(function(a,b){return a[0]<b[0]?-1:1})}function m(a,b,c,d){var e=a[b];return d?c(e,b,a):e[0]}function q(b,e,f,l){for(var g,k,m,p=b;p<f;){g=r[p++];b=d?g:g[1];g=d?p:g[2];for(var q=e;q<l;)k=t[q++],m=a?k:k[1],k=a?q:k[2],m=n(b,m,g,k,c,h),null!=m&&v.push(m)}}var v=[];if("boolean"!=typeof d||"boolean"!=typeof a)k=f,f=d,d=!1,g=a,a=!1;e=l.createCallback(e,f);b=l.createCallback(b,
g);n=z(n,k);d=d&&l.isArray(c);a=a&&l.isArray(h);var r=s(c,e,d),t=s(h,b,a);f=r.length;g=t.length;if(0>=f||0>=g)return[];k=0;for(var p=m(r,0,e,d),u=0,w=m(t,0,b,a);k<f&&u<g;)if(w<p)w=m(t,++u,b,a);else if(w>p)p=m(r,++k,e,d);else{for(var x=k+1;x<f&&m(r,x,e,d)==p;x++);for(var y=u+1;y<g&&m(t,y,b,a)==w;y++);q(k,u,x,y);(k=x)<f&&(p=m(r,k,e,d));(u=y)<g&&(w=m(t,u,b,a))}return v},uniqueJoin:function(c,h,e,b,n,d,a,f){var g=c.length,k=h.length;if(0>=g||0>=k)return[];e=l.createCallback(e,d);b=l.createCallback(b,
a);n=z(n,f);d=c[0];a=h[0];f=e(d,0,c);for(var s=b(a,0,h),m=0,q=0,v=[];m<g&&q<k;)if(s<f)a=h[++q],s=b(a,q,h);else if(s>f)d=c[++m],f=e(d,m,c);else{var r=n(d,a,m,q,c,h);null!=r&&v.push(r);++q<k&&(a=h[q],s=b(a,q,h))}return v}})})(_);
